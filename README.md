# DE-DB-2.3-DML-SQL
### Анализ данных о заказах и клиентах
У вас есть база данных для интернет-магазина, которая включает следующие таблицы:
- Customers — информация о клиентах:
CustomerID (int, PK) — уникальный идентификатор клиента.
FirstName (varchar) — имя клиента.
LastName (varchar) — фамилия клиента.
Email (varchar) — адрес электронной почты клиента.
- Orders — информация о заказах:
OrderID (int, PK) — уникальный идентификатор заказа.
CustomerID (int) — идентификатор клиента, совершившего заказ.
OrderDate (datetime) — дата и время создания заказа.
TotalAmount (decimal) — общая сумма заказа.
- OrderDetails — информация о деталях заказов:
OrderDetailID (int, PK) — уникальный идентификатор детали заказа.
OrderID (int) — идентификатор заказа.
ProductID (int) — идентификатор продукта в заказе.
Quantity (int) — количество продуктов в заказе.
UnitPrice (decimal) — цена за единицу продукта.
### Ваша задача:
Напишите SQL-запросы, которые выполняют следующие действия:
- Возвращает список клиентов (имя и фамилия) с наибольшей общей суммой заказов.
- Для каждого клиента из пункта 1 выводит список его заказов (номер заказа и общая сумма) в порядке убывания общей суммы заказов.
- Выводит только тех клиентов, у которых общая сумма заказов превышает среднюю общую сумму заказов всех клиентов.
### Важно использовать подзапросы, агрегатные функции и объединения таблиц, чтобы выполнить это задание. Оптимизируйте запрос, где это возможно.

### Задание ПРО
Давайте усложним задание еще больше. Добавим дополнительные таблицы и требования:
Дополнительные таблицы:
- Products -— информация о продуктах:
ProductID (int, PK) — уникальный идентификатор продукта.
ProductName (varchar) — название продукта.
CategoryID (int) — идентификатор категории продукта.
Price (decimal) — цена продукта.
- ProductReviews — информация об отзывах о продуктах:
ReviewID (int, PK) — уникальный идентификатор отзыва.
ProductID (int) — идентификатор продукта, к которому относится отзыв.
CustomerID (int) — идентификатор клиента, оставившего отзыв.
Rating (int) — оценка продукта от 1 до 5.
ReviewText (text) — текст отзыва.
### Дополнительные требования:
- Ваш SQL-запрос должен расшириться для учета общей суммы заказов и общего количества товаров, купленных каждым клиентом.
- Заказы клиентов должны быть разделены на две категории: «Новые заказы» (заказы, созданные менее месяца назад) и «Старые заказы» (заказы созданные более месяца назад).
- Вам нужно рассчитать среднюю оценку продукта для каждого клиента на основе отзывов, оставленных ими о продуктах.
- Выведите список клиентов вместе с их общей суммой заказов, общим количеством товаров, новыми и старыми заказами, а также средней оценкой продукта.
## Логика решения:
1. Сформирован срипт для запросов в БД:
- Скрипт DML c различными запросами к БД представлен в файле по пути: (<code>[./quest.sql]()</code>)
1. Сформирован PRO-срипт для запросов в БД:
- Скрипт DML c различными запросами к БД представлен в файле по пути: (<code>[./quest.sql]()</code>)